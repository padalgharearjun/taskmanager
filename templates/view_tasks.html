{% extends "base.html" %}

{% block title %}Login{% endblock %}

{% block content %}
<div class="content">
    <!-- User Info Section -->
    <div class="user-info">
        <p>Logged in as: <strong>{{ session['username'] }}</strong></p>
        <form method="POST" action="{{ url_for('logout') }}">
            <button type="submit">Logout</button>
        </form>
    </div>

    <!-- Create Task Button -->
    <a href="{{ url_for('create_task') }}" class="create-task-button">Create New Task</a>

    <!-- Status Dashboard -->
    <div class="dashboard">
        <div class="dashboard-item high-priority">
            High Priority: {{ high_priority_tasks }} ({{ high_priority_completed }} Completed, {{ high_priority_pending
            }} Pending)
        </div>
        <div class="dashboard-item medium-priority">
            Medium Priority: {{ medium_priority_tasks }} ({{ medium_priority_completed }} Completed, {{
            medium_priority_pending }} Pending)
        </div>
        <div class="dashboard-item low-priority">
            Low Priority: {{ low_priority_tasks }} ({{ low_priority_completed }} Completed, {{ low_priority_pending }}
            Pending)
        </div>
        <div class="dashboard-item">
            Total Tasks: {{ total_tasks }}
        </div>
    </div>

    <!-- Search and Filter Options -->
    <div class="filter-box">
        <form method="GET" action="{{ url_for('view_tasks') }}">
            <input type="text" name="search" placeholder="Search tasks" value="{{ search_query }}">
            <select name="priority">
                <option value="">All Priorities</option>
                <option value="Low" {% if priority_filter=='Low' %}selected{% endif %}>Low</option>
                <option value="Medium" {% if priority_filter=='Medium' %}selected{% endif %}>Medium</option>
                <option value="High" {% if priority_filter=='High' %}selected{% endif %}>High</option>
            </select>
            <input type="date" name="due_date" value="{{ due_date_filter }}">
            <input type="submit" value="Filter">
        </form>
    </div>

    <h1>Your Tasks</h1>

    <!-- Task Table -->
    <table>
        <thead>
            <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Due Date</th>
                <th>Priority</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% if tasks %}
            {% for task in tasks %}
            <tr>
                <td>{{ task.title }}</td>
                <td>{{ task.description }}</td>
                <td>{{ task.due_date.strftime('%Y-%m-%d') if task.due_date else 'No due date' }}</td>
                <td>
                    <span class="priority-badge priority {{ task.priority | lower }}">{{ task.priority }}</span>
                </td>
                <td>
                    <span
                        class="status-badge status {% if task.completed %}completed{% else %}not-completed{% endif %}">
                        {% if task.completed %}Completed{% else %}Not Completed{% endif %}
                    </span>
                </td>
                <td>
                    <a href="{{ url_for('edit_task', task_id=task.id) }}">Edit</a> |
                    <a href="{{ url_for('delete_task', task_id=task.id) }}">Delete</a>
                </td>
            </tr>
            {% endfor %}
            {% else %}
            <tr>
                <td colspan="6">No tasks found</td>
            </tr>
            {% endif %}
        </tbody>
    </table>

    <div class="pagination">
        {% if pagination.has_prev %}
        <a
            href="{{ url_for('view_tasks', page=pagination.prev_num, search=search_query, priority=priority_filter, due_date=due_date_filter) }}">Previous</a>
        {% endif %}
        {% if pagination.has_next %}
        <a
            href="{{ url_for('view_tasks', page=pagination.next_num, search=search_query, priority=priority_filter, due_date=due_date_filter) }}">Next</a>
        {% endif %}
    </div>

    <!-- Download Report and Pagination -->
    <div class="button-container">
        <form method="GET" action="{{ url_for('download_report') }}">
            <input type="hidden" name="search" value="{{ search_query }}">
            <input type="hidden" name="priority" value="{{ priority_filter }}">
            <input type="hidden" name="due_date" value="{{ due_date_filter }}">
            <button type="submit" class="download-report-button">Download Report</button>
        </form>
    </div>
</div>
{% endblock %}